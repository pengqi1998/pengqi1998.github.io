<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  
  <title>Spring基础02 | 鹏鹏的博客</title>
  <meta name="author" content="鹏">
  
  <meta name="description" content="Sping之ioc与aop整合ioc与aop的整合">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Spring基础02"/>
  <meta property="og:site_name" content="鹏鹏的博客"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="鹏鹏的博客" type="application/atom+xml">
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">鹏鹏的博客</a></h1>
  <h2><a href="/">记录我的成长之路</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>

      <li>aaaaaa</li>

  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article id="post-Spring基础02" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2020-07-31T14:08:00.000Z"><a href="/2020/07/31/Spring基础02/">2020-07-31</a></time>
      
      
  
    <h1 class="p-name title" itemprop="headline name">Spring基础02</h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h1 id="Sping之ioc与aop整合"><a href="#Sping之ioc与aop整合" class="headerlink" title="Sping之ioc与aop整合"></a>Sping之ioc与aop整合</h1><p>ioc与aop的整合</p>
<a id="more"></a>
<h2 id="基于xml文件的容器配置："><a href="#基于xml文件的容器配置：" class="headerlink" title="基于xml文件的容器配置："></a>基于xml文件的容器配置：</h2><p>一般是在ssm项目中使用。</p>
<h2 id="properties文件加载"><a href="#properties文件加载" class="headerlink" title="properties文件加载"></a>properties文件加载</h2><p>用来加载类路径下的properties文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--此标签为使用property时需要的标签。且指定的是jar包中的类，无法通过直接注解加载</span></span><br><span class="line"><span class="comment">    location为配置文件,此处写法为相对路径写法 还可写 classpath：jdbc.properties，意为类下路径。还可带上*号，意为本地类路径下，包括jar包里面也找</span></span><br><span class="line"><span class="comment">    ignore-unresolvable为暂时忽略无法解析的key，默认为ture ，一般需要加上,当我们引入多个properties文件的时会用到--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"jdbc.properties"</span> <span class="attr">ignore-unresolvable</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcjiazai"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;user&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--注意，此处默认一般最大值为8，此处写超过8会发生错误，一般这个不用写--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name="initialSize" value="5"&gt;&lt;/property&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="实现ioc的方式"><a href="#实现ioc的方式" class="headerlink" title="实现ioc的方式:"></a>实现ioc的方式:</h2><p>另一种重要方式</p>
<ul>
<li>基于注解扫描：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--运行时注解：理解成一种标志(对象)，在运行期间通过反射读取类或方法或形参上的注解。--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--@Controller，@Service，@Respository，@Component没有本质区别。不能加在接口上--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--识别指定包下的所有类的特定注解：@Controller，@Service，@Respository，@Component，@Autowired，@Resource等...近20个--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.pq.*"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Qaaa</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">zzz</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Qbbb</span> <span class="keyword">implements</span> <span class="title">Qaaa</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zzz</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Service</span>(<span class="string">"ac"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Qccc</span> <span class="keyword">implements</span> <span class="title">Qaaa</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zzz</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="实现di依赖注入的方式："><a href="#实现di依赖注入的方式：" class="headerlink" title="实现di依赖注入的方式："></a>实现di依赖注入的方式：</h2><ul>
<li>property标签的set注入(p-namespce–&gt;p:变量名)</li>
<li>constructor-arg标签的构造器注入(c-namespace–&gt;c:形参名)</li>
<li>内部bean注入</li>
<li>自动装配：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//@Autowired,@Resource可以注解到set方法和成员变量上，如果注到成员变量上可以不要set、get</span></span><br><span class="line">  <span class="comment">//@Autowired byType在初始化sprnig容器时，检测成员变量带有Autowired注解，则按照类型去容器中查找bean对象</span></span><br><span class="line">  <span class="comment">//@Resource byName,byType先根据成员变量的名称去获取bean赋值，如果找不到再按照类型去获取bean。</span></span><br><span class="line">  <span class="comment">//此处括号里可理解为给bean起的id名，可不写，即默认为类名，首字母小写</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Aaaaa</span> </span>&#123;</span><br><span class="line">    <span class="comment">//自动注入的注解，也有写在set方法上的，不过很少，一般写法都是写在需要注入的属性上面</span></span><br><span class="line">    <span class="comment">//机制：在进行初始化spring容器时，检测到成员变量中有自动注入标签，会根据类型自动去spring容器中寻找</span></span><br><span class="line">    <span class="comment">//当此处自动注入一个接口类时，请注意接口有几个实现类，若为两个以上，用此注解会发生错误，因为他是按照类型去寻找的</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Bbbbb b;</span><br><span class="line">    <span class="comment">// @Autowired</span></span><br><span class="line">    <span class="comment">// private Qaaa qa;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//同一个接口两个实现类的时候</span></span><br><span class="line">    <span class="comment">//1.@Resource后不跟东西，且接口实现类的注解未给id时，则默认根据成员变量的属性名字去查找（首字母小写），找不到就根据接口类型去找，若有两个以上，则出现错误</span></span><br><span class="line">    <span class="comment">//2.@Resource后不跟东西，且接口实现类的注解给了id时，则需要属性名和id相匹配才能查到，查不到也不会根据类型去找,直接报错</span></span><br><span class="line">    <span class="comment">//3.@Resource后跟name，且接口实现类的注解给了id时，此时属性名已经没有作用。需要name与id匹配才能找到，查不到也不会根据类型去找,直接报错</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> Qaaa ac;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Aaaaa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"aaaaa无参构造被加载了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getaaa</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(b);</span><br><span class="line">        System.out.println(<span class="string">"aaaa成功进行了set注入"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">geterror</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(ac);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>集合注入：<ul>
<li>array</li>
<li>list</li>
<li>set</li>
<li>map</li>
</ul>
</li>
</ul>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>以上内容除了集合注入，内部bean以及工厂bean，其他全部需要掌握。<br>bean,property,constructor-arg,context:property-placeholde,content:component-scan<br>@Controller,@Service,@Repository,@Component,@Autowired，@Resource</p>
<h2 id="基于Java类的容器配置"><a href="#基于Java类的容器配置" class="headerlink" title="基于Java类的容器配置"></a>基于Java类的容器配置</h2><p>在springboot框架项目中使用。<br>使用AnnotationConfigApplicationContext容器类。<br><font colo="green"><br>@Configuration  配置<br>@PropertySource Property加载<br>@ComponentScan 包扫描<br>@Value<br>@Bean<br>@PostConstruct<br>@PreDestory<br></font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//相当于xml配置文件(加载property，包扫描，bean，$&#123;&#125;,property,constructor-arg)</span></span><br><span class="line"><span class="comment">//@Configuration表示当前类是一个配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//意为加载propertry类，底层是string数组，可加在多个配置文件</span></span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"jdbc.properties"</span>)</span><br><span class="line"><span class="comment">//意为加载包（包扫描），内有values属性，一般省略，直接写</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.pq.*"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sprtwoaaa</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;driver&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;user&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//此处的bean等同于xml里面的外部bean，要返回一个对象，可在当前配置类里面相互调用，写法等同于xml里面的写法。此处不是内部bean</span></span><br><span class="line">    <span class="meta">@Bean</span>(initMethod = <span class="string">"init"</span>,destroyMethod = <span class="string">"close"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">createDruid</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"createDruid"</span>);</span><br><span class="line">        DruidDataSource druidDataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        druidDataSource.setUrl(url);</span><br><span class="line">        druidDataSource.setDriverClassName(driver);</span><br><span class="line">        druidDataSource.setUsername(username);</span><br><span class="line">        druidDataSource.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法名是id，形参是做di依赖注入。</span></span><br><span class="line">    <span class="comment">//此处高能，如果在此处使用bean标签来装配这个对象，则对象实体类里面不允许再写@service@controller等标签，会导致重复装配。用此方法注入时不用在实体类写自动注入注解</span></span><br><span class="line">    <span class="comment">//如果实体类上写了@service@controller等标签，则此处bean必须去掉。因为本配置类写了包扫描，在扫描时已经根据标签将其装配为bean，注入时直接写自动注入标签即可</span></span><br><span class="line">    <span class="comment">//@Scope("prototype")等同xml里Scope属性，不写默认为加载配置类时进行实例化（单例模式），写prototype为getbean时才实例化（非单例）</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sprtwobbb <span class="title">getsprbbb</span><span class="params">(DataSource ds)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"getsprbbb"</span>);</span><br><span class="line">        Sprtwobbb stb = <span class="keyword">new</span> Sprtwobbb();</span><br><span class="line">        stb.setDs(ds);</span><br><span class="line">        <span class="keyword">return</span> stb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sprtwoone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//相当于加载xml文件，这是另一个接口，加载配置类。都是通过反射，效果一样</span></span><br><span class="line">        ApplicationContext ac=<span class="keyword">new</span> AnnotationConfigApplicationContext(Sprtwoaaa<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">//        Sprtwoaaa bean = ac.getBean(Sprtwoaaa.class);</span></span><br><span class="line"><span class="comment">//        bean.printInfo();</span></span><br><span class="line"><span class="comment">//        Sprtwobbb bean2 = ac.getBean(Sprtwobbb.class);</span></span><br><span class="line"><span class="comment">//        bean2.hello();</span></span><br><span class="line">        Sprtwobbb bean = (Sprtwobbb)ac.getBean(<span class="string">"getsprbbb"</span>);</span><br><span class="line">        bean.hello();</span><br><span class="line">        <span class="comment">//销毁方法，销毁整个容器，会触发销毁方法</span></span><br><span class="line"><span class="comment">//        ((AnnotationConfigApplicationContext) ac).registerShutdownHook();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="spring-test"><a href="#spring-test" class="headerlink" title="spring-test"></a>spring-test</h2><h3 id="spring-test-1"><a href="#spring-test-1" class="headerlink" title="spring-test:"></a>spring-test:</h3><p>@Runwith(SpringJunit4ClassRunner.class)|@RunWith(SpringRunner.class)<br>@ContextConfiguration(“classpath:XXXX.xml”)</p>
<p>spring-test与junit整合：</p>
<h3 id="junit"><a href="#junit" class="headerlink" title="junit:"></a>junit:</h3><p>@Test:注解测试方法<br>@FixMethodOrder:指定测试方法的执行顺序<br>@BeforeClass:在所有的测试方法执行之前执行一次的初始化方法，做初始化<br>@Before：<br>@After:<br>@AfterClass：做销毁工作<br>Assert断言类：assertEquals，assertNull，assertNotNull</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//没写xml懒得配了 RunWith写了spring和text版本 目前用的4 ContextConfiguration指得是数据源，即xml配置文件，路径要根据项目中路径去配置，写完这两行后，可写29行</span></span><br><span class="line"><span class="comment">//@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">//@ContextConfiguration("classpath:xxxx.xml")//从类路径下查找，可指多个</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//此注解意为以下text根据方法名的升序依次进行</span></span><br><span class="line"><span class="meta">@FixMethodOrder</span>(MethodSorters.NAME_ASCENDING)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">textjunit</span> </span>&#123;</span><br><span class="line">    <span class="comment">//集成了spring后，即可测试spring代码.跳43行</span></span><br><span class="line"><span class="comment">//    @Resource</span></span><br><span class="line"><span class="comment">//    private ccc c;</span></span><br><span class="line">    <span class="meta">@BeforeClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zuizao</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"*****这是最先执行的方法，一般写初始化用。必须是静态方法******"</span>);&#125;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">meige</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"----------这是每个测试进行之前要走的方法，可以配一些相同环境"</span>);&#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">text1_jtone</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        int i= c.getccc();</span></span><br><span class="line">        System.out.println(<span class="string">"测试1"</span>);&#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">text2_jtone</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"测试2"</span>);&#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">text3_jtone</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"测试3"</span>);&#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">text4_jtone</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//假如说i是一个方法的返回值，然后进行断言处理</span></span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//断言处理，相当于提前预判，若与断言值不同，则状态爆黄</span></span><br><span class="line">        Assert.assertEquals(i,<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//非空断言之类的，方法很多  Assert.assertNotNull()……</span></span><br><span class="line">        System.out.println(<span class="string">"测试4"</span>);&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">meige02</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"这是每个测试走完之后的方法"</span>);&#125;</span><br><span class="line">    <span class="meta">@AfterClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zuihou</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"****这是所有测试走完之后进行的方法，一般做资源销毁处理，也必须是静态*****"</span>);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><h4 id="什么是aop："><a href="#什么是aop：" class="headerlink" title="什么是aop："></a>什么是aop：</h4><p>​    aop：是面向切面编程，是对oop面向对象编程的一种补充完善。<br>​    日志，执行效率监测功能相对于付款核心功能，是辅助性的功能，把这些功能称为切面。<br>​    在代理层面，切面就是一个独立存在的类。切面类中的方法称为通知方法。</p>
<h4 id="aop能干什么："><a href="#aop能干什么：" class="headerlink" title="aop能干什么："></a>aop能干什么：</h4><p>​    做统一事务管理；做统一日志管理；统一异常处理</p>
<h4 id="aop怎么实现"><a href="#aop怎么实现" class="headerlink" title="aop怎么实现:"></a>aop怎么实现:</h4><p>​    <strong>动态代理</strong>。</p>
<h4 id="aop中的几个概念："><a href="#aop中的几个概念：" class="headerlink" title="aop中的几个概念："></a>aop中的几个概念：</h4><p>​    aspect：切面，是一个类，类中是非核心的辅助功能代码实现。<br>​    advice：通知，是aspect类中的方法。分为前置通知，返回通知，最终通知，异常通知<br>​    weave:织入，通过动态代理模把通知方法式插入到。<br>​    joinpoint：连接点，是一个方法，其实是核心业务方法。<br>​    target:目标对象，连接点方法所在的对象。</p>
<p>​    总结：通过动态代理把aspect中的advice方法weave到target的joinpoint方法的周围。</p>
<p>通过代理加通知的写法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实体类</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AliPayImpl</span> <span class="keyword">implements</span> <span class="title">IPay</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">pay</span><span class="params">(<span class="keyword">double</span> money, String payUser, String receiveUser)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"阿里付款："</span>+payUser+<span class="string">"-"</span>+money+<span class="string">"-"</span>+receiveUser);</span><br><span class="line">        TimeAspect.begin();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">700</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        TimeAspect.end();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextPay</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//此行代码是设置系统属性键值对，括号内意思为将动态代理的对象保存到这个指定的文件夹里面。在prothree里com里sun里能找到</span></span><br><span class="line">        System.setProperty(<span class="string">"sun.misc.ProxyGenerator.saveGeneratedFiles"</span>,<span class="string">"true"</span>);</span><br><span class="line">        <span class="comment">//已经存在的付款对象，不改变源码，去修改代码逻辑。</span></span><br><span class="line">        IPay pay = <span class="keyword">new</span> AliPayImpl();</span><br><span class="line">        IPay dailipay = getProxy(pay);</span><br><span class="line">        dailipay.pay(<span class="number">100</span>,<span class="string">"zhangsan"</span>,<span class="string">"boss"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//因为不想改动源代码，但是需要往里加入自己的逻辑功能，所以需要一个代理类对象，</span></span><br><span class="line">    <span class="comment">//即通过映射和克隆生成一个和源代码一模一样的对象，原对象持有代理类对象</span></span><br><span class="line">    <span class="comment">//原本所有指向原对象的依赖统一由代理来接管</span></span><br><span class="line">    <span class="comment">//动态代理。动态体现在用的时候才会在内存中生成，静态代理是指加载时加载到内存中（体现了懒加载的思想？）</span></span><br><span class="line">    <span class="comment">//需要我们指定创建代理对象/目标对象实现的接口的类型</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IPay <span class="title">getProxy</span><span class="params">(IPay p)</span></span>&#123;</span><br><span class="line">        <span class="comment">//newProxyInstance静态方法，用来接收原代理对象和需要代理的方法，方法必须是public修饰,会返回一个方法结果</span></span><br><span class="line">        <span class="comment">//p.getClass().getClassLoader()获得类加载器，实现代理类必须的参数</span></span><br><span class="line">        <span class="comment">//new Class[]&#123;IPay.class&#125;传入需要代理的类，此处必须写接口重写其public方法</span></span><br><span class="line">        <span class="comment">//new InvocationHandler() 即写了一个InvocationHandler接口的实现类，重写了里面的invoke方法</span></span><br><span class="line">        IPay iPay = (IPay) Proxy.newProxyInstance(p.getClass().getClassLoader(), <span class="keyword">new</span> Class[]&#123;IPay<span class="class">.<span class="keyword">class</span>&#125;, <span class="title">new</span> <span class="title">InvocationHandler</span>()</span>&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">//proxy指代理类对象，method指被代理的方法，args是里面的参数</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span>&#123;</span><br><span class="line">                <span class="comment">//result接收方法返回的结果</span></span><br><span class="line">                Object result =<span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//加入自己的代码</span></span><br><span class="line">                    TimeAspect.begin();</span><br><span class="line">                    <span class="comment">//invoke，理解为唤醒，需要传入两个参数，一个是被代理对象，一个是参数</span></span><br><span class="line">                    <span class="comment">//被代理对象用来调用method方法，可理解为叫过来原对象，给他需要的参数，调用他的方法，得到一个结果。</span></span><br><span class="line">                    <span class="comment">//此处体现持有关系</span></span><br><span class="line">                    result = method.invoke(p, args);</span><br><span class="line">                    System.out.println(<span class="string">"代理成功"</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="comment">//加入自己的代码</span></span><br><span class="line">                    System.out.println(<span class="string">"发生了异常"</span>);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">//加入自己的代码</span></span><br><span class="line">                    TimeAspect.end();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> iPay;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="spring的aop是怎么实现"><a href="#spring的aop是怎么实现" class="headerlink" title="spring的aop是怎么实现:"></a>spring的aop是怎么实现:</h4><ul>
<li><p>jar：spring的环境（5个）；spring的aop的依赖jar（2个）；aspectj组件的jar（3个）；cglib组件的jar.（1个）</p>
</li>
<li><p>切入点表达式：定义连接点集合。</p>
</li>
<li><p>两种实现方式：</p>
<ul>
<li><p>基于aspectj注解:</p>
<ul>
<li>在元数据配置中，开启aspectj注解识别。</li>
<li>写service层的服务对象(aop中的目标对象)，加服务方法（aop的连接点方法）。</li>
<li>写切面类，写通知方法。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="comment">//装配为一个bean</span></span><br><span class="line"><span class="meta">@Aspect</span><span class="comment">//成为一个切面类对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopDemoOne</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AopDemoOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"走了无参构造，以下几种通知，按需去写，不用都写"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//此注解必须有一个方法来承载，意为指向哪些或哪个文件加上aop</span></span><br><span class="line">    <span class="comment">//(void com.pq.aop.AliPayImpl.pay(java.lang.String等等))</span></span><br><span class="line">    <span class="comment">//(* com.javasm.service.*.*(..))第一个参数写返回值类型，*表示所有。第二个参数写指向哪些文件（或哪个）的哪个（哪些）方法，第三个参数指形参（可具体也可写..表示所有）</span></span><br><span class="line">    <span class="comment">//↑第一个 ↑第二个com到() ↑第三个指括号里面</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.pq.aop.*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">servicePointcut</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//前置通知方法,可以得到连接点的信息（方法，实参）</span></span><br><span class="line">    <span class="comment">//括号内必须有一个值，不能为空，否则编译报错,一般用来指向承载方法</span></span><br><span class="line">    <span class="comment">//意为此方法作为方法的前置通知织入到指定方法内</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"servicePointcut()"</span>)</span><br><span class="line">    <span class="comment">//如果想获得方法信息，可加入形参JoinPoint 连接点对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">befoerzhixing</span><span class="params">(JoinPoint jp)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行之前的通知"</span>);</span><br><span class="line">        <span class="comment">//获取到参数信息</span></span><br><span class="line">        Object[] args = jp.getArgs();</span><br><span class="line">        <span class="comment">//获取到目标对象</span></span><br><span class="line">        Object target = jp.getTarget();</span><br><span class="line">        <span class="comment">//获取到方法名</span></span><br><span class="line">        String name = jp.getSignature().getName();</span><br><span class="line">        <span class="comment">//获取到方法对象</span></span><br><span class="line">        <span class="comment">//MethodSignature ms = (MethodSignature) jp.getSignature();</span></span><br><span class="line">        <span class="comment">//获取到方法，然后传入参数，也可以实现环绕通知，不过一般不这么写</span></span><br><span class="line">        <span class="comment">//Method method = ms.getMethod();</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"获取到方法信息"</span>+args+<span class="string">"---"</span>+target+<span class="string">"-----"</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回通知方法,可以得到连接点的信息（方法，实参）,还可以得到连接点的返回值,自定义命名，然后作为实参传入到afterzhixing方法，可以打印出来</span></span><br><span class="line">    <span class="meta">@AfterReturning</span>(pointcut = <span class="string">"servicePointcut()"</span>,returning = <span class="string">"bbb"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterzhixing</span><span class="params">(JoinPoint jp,Object bbb)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行之后的通知"</span>);</span><br><span class="line">        System.out.println(<span class="string">"获取到返回值"</span>+bbb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//异常通知方法。可以得到连接点的信息（方法，实参）,还可以得到异常信息,自定义命名，然后作为实参传入到yichangzhixing方法，可以打印出来</span></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(pointcut = <span class="string">"servicePointcut()"</span>,throwing = <span class="string">"ccc"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">yichangzhixing</span><span class="params">(Exception ccc)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"捕获异常的通知"</span>);</span><br><span class="line">        System.out.println(<span class="string">"获取到异常信息"</span>+ccc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//最终通知方法。可以得到连接点的信息（方法，实参）</span></span><br><span class="line">    <span class="comment">//括号内必须有一个值，不能为空，否则编译报错</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"servicePointcut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zuizhong</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"最终的通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//环绕通知：一个顶四个，应用场景较少</span></span><br><span class="line">    <span class="comment">//比如事务切面中，就需要环绕着核心业务来写。打开链接，提交，关闭，回滚</span></span><br><span class="line">    <span class="comment">// Around环绕通知标签</span></span><br><span class="line"><span class="comment">//    @Around("servicePointcut()")</span></span><br><span class="line">    <span class="comment">//必须有返回值类型，必须写形参</span></span><br><span class="line"><span class="comment">//    public Object aroundAdvice(ProceedingJoinPoint jp)&#123;</span></span><br><span class="line"><span class="comment">//                Object[] args = jp.getArgs();</span></span><br><span class="line"><span class="comment">//        Object target = jp.getTarget();</span></span><br><span class="line"><span class="comment">//        String name = jp.getSignature().getName();</span></span><br><span class="line"><span class="comment">//        Object result = null;</span></span><br><span class="line"><span class="comment">//        try &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println("前置通知");</span></span><br><span class="line"><span class="comment">//            result = jp.proceed();//method.invoke</span></span><br><span class="line"><span class="comment">//            System.out.println("返回通知： "+result);</span></span><br><span class="line"><span class="comment">//        &#125; catch (Throwable e) &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println("异常："+e.getMessage());</span></span><br><span class="line"><span class="comment">//        &#125;finally &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println("最终:");</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        return result;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--识别aspectj注解:@Aspect,@Pointcut,@Before,@After,@AfterThrowing,@AfterReturning,@Around--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--proxy-target-class：默认false，如果目标对象有接口，则使用Proxy，如果没接口，则使用CGLIB；</span></span><br><span class="line"><span class="comment">                               true,只使用CGLIB创建--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--&lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--识别注解（包扫描）：@Controller，@Service，@Repository，@Component，@Autowired，@Resource,@Configuration,@Bean,@Value,@PropertySource...--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--&lt;context:component-scan base-package="com.pq"&gt;&lt;/context:component-scan&gt;--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.pq"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>基于xml配置:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--下为xml配置aop的写法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"wasd"</span> <span class="attr">class</span>=<span class="string">"com.pq.aopthree.XmlAop"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--引用指向bean的id--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"wasd"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--此处写切入点，跟写在类里一样--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"ppp"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.pq.aopthree.Peiheone.*(..))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:pointcut</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--aop后可指定织入时间，方法写aop中的方法 ref指向引用的切入点--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"befoerzhixing"</span> <span class="attr">pointcut-ref</span>=<span class="string">"ppp"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--&lt;aop:after-throwing method="run" throwing="e"&gt;&lt;/aop:after-throwing&gt;--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--&lt;aop:after-returning method="run" returning="abc"&gt;&lt;/aop:after-returning&gt;--&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//xml配置通知的方法，不需要写任何标签</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XmlAop</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XmlAop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"走了无参构造"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果想获得方法信息，可加入形参JoinPoint 连接点对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">befoerzhixing</span><span class="params">(JoinPoint jp)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行之前的通知"</span>);</span><br><span class="line">        Object[] args = jp.getArgs();</span><br><span class="line">        Object target = jp.getTarget();</span><br><span class="line">        String name = jp.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">"获取到方法信息"</span>+args+<span class="string">"---"</span>+target+<span class="string">"-----"</span>+name);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//多种写法</span></span><br><span class="line"><span class="comment">//运行时注解</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="comment">//ElementType.METHOD定位类型，意为定到方法 ElementType.TYPE定位到类，还有形参啥的</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyLog &#123;</span><br><span class="line">    <span class="comment">//注解上的操作行为</span></span><br><span class="line">    <span class="function">String <span class="title">model</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">    <span class="function">String <span class="title">ops</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Peihe</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Peiheone</span> <span class="keyword">implements</span> <span class="title">Peihe</span> </span>&#123;</span><br><span class="line">    <span class="comment">//给需要注解的方法加上log标签，就可以根据标签加入到aop中，按需加入</span></span><br><span class="line">    <span class="meta">@MyLog</span>(model = <span class="string">"方法名字"</span>,ops = <span class="string">"方法功能"</span>)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行了方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/SpringMVC/">SpringMVC</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/学习分享-框架-ioc/">-学习分享 -框架 -ioc</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="https://pengqi1998.github.io/2020/07/31/Spring%E5%9F%BA%E7%A1%8002/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="as_sitesearch" value="pengqi1998.github.io">
  </form>
</div>


  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/SpringMVC/">SpringMVC</a><small>3</small></li>
  
    <li><a href="/categories/知识整合/">知识整合</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/学习分享-导航/">-学习分享 -导航</a><small>1</small></li>
  
    <li><a href="/tags/学习分享-框架-ioc/">-学习分享 -框架 -ioc</a><small>2</small></li>
  
    <li><a href="/tags/学习分享-框架-mvc/">-学习分享 -框架 -mvc</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2020 鹏
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
